# Maven工程关系

Maven工具基于POM（Project Object Model，项目对象模型）模式实现的。在Maven中每个项目都相当于是一个对象，对象（项目）和对象（项目）之间是有关系的。关系包含了：依赖、继承、聚合，实现Maven项目可以更加方便的实现导jar包、拆分项目等效果。

## 依赖

传递性依赖是Maven2.0的新特性。假设你的项目依赖于一个库，而这个库又依赖于其他库。你只需要加上你直接依赖的库，Maven会隐式的把这些库间接依赖的库也加入到你的项目中。这个特性是靠解析从远程仓库中获取的依赖库的项目文件实现的。一般的，这些项目的所有依赖都会加入到项目中，或者从父项目继承，或者通过传递性依赖。

### 传递性

如果项目A依赖了项目B，那么项目C依赖项目A时会自动把项目A和项目B都导入进来。

### 两个原则

#### 第一原则：最短路径优先原则

**最短路径优先**意味着项目依赖关系树中路径最短的版本会被使用。

例如，假设A、B、C之间的依赖关系是A->B->C->D(2.0)  和A->E->(D1.0)，那么D(1.0)会被使用，因为A通过E到D的路径更短。

#### 第二原则：最先声明原则

依赖路径长度是一样的的时候，第一原则不能解决所有问题，比如这样的依赖关系：A–>B–>Y(1.0)，A–>C–>Y(2.0)，Y(1.0)和Y(2.0)的依赖路径长度是一样的，都为2。那么到底谁会被解析使用呢？

在maven2.0.8及之前的版本中，这是不确定的，但是maven2.0.9开始，为了尽可能避免构建的不确定性，maven定义了依赖调解的第二原则：**第一声明者优先。在依赖路径长度相等的前提下，在POM中依赖声明的顺序决定了谁会被解析使用。顺序最靠前的那个依赖优胜**。

### 排除依赖

**exclusions**： 用来排除传递性依赖，其中可配置多个exclusion标签，每个exclusion标签里面对应的有groupId, artifactId, version三项基本元素。**`注意：不用写版本号`**。

### 依赖范围

#### compile

**`默认范围`**。如果没有指定，就会使用该依赖范围。表示该依赖在编译和运行时都生效。

#### provided

**`已提供依赖范围`**，使用此依赖范围的Maven依赖。例如servlet-api，编译和测试项目的时候需要该依赖，但在运行项目的时候，由于容器（Tomcat）已经提供，就不需要Maven重复地引入一遍。

#### runtime

表明编译时不需要生效，而**`只在运行时生效`**。例如JDBC驱动实现，项目代码编译只需要JDK提供的JDBC接口，只有在执行测试或者运行项目的时候才需要实现上述接口的具体JDBC驱动。

#### system

系统范围与provided类似，不过**`必须显式指定一个本地系统路径的JAR`**，此类依赖应该一直有效，Maven也不会去仓库中寻找它。但是使用system范围依赖时必须通过systemPath元素显式地指定依赖文件的路径。

#### test

表明此依赖范围的依赖，**`只在编译测试代码和运行测试的时候需要`**，应用的正常运行不需要此类依赖。例如Unit，它只有在编译测试代码及运行测试的时候才需要。

#### import

import范围只适用于pom文件中的<dependencyManagement>部分，表明指定的POM**`必须使用<dependencyManagement>部分的依赖`**，相当于强制的指定了版本号。
**`注意：import只能用在dependencyManagement的scope里。`**

## 继承

如果项目A继承项目B，则代表项目A默认依赖项目B依赖的所有资源，且可以应用项目B中定义的所有资源信息，继承本质上是POM文件的继承。

**`被继承的项目（项目B）只能是POM工程。`**

**`注意：`**父项目中放在<dependencyManagement>中的内容是不被子项目继承的，不可以直接使用，放在<dependencyManagement>中的内容主要目的是进行版本管理。里面的内容在子项目中依赖时坐标只需要填写<group id>和<artifact id>即可。（如果子项目不希望使用父项目的版本，可以明确配置version）。

## 聚合

当我们开发的工程拥有2个以上模块的时候，每个模块都是一个独立的功能集合。开发的时候每个模块都可以独立编译，测试，运行，这个时候我们就需要一个聚合项目。

在创建聚合项目的过程中，**`总的项目必须是一个POM项目（Maven Project）`**，各子模块可以是任意类型模块（Maven Module）。

聚合的前提是继承，聚合包含了继承的特性。

聚合时多个项目的本质还是一个项目，这些项目被一个大的父项目包含，且这时父项目类型为pom类型。同时在父项目的pom.xml中出现<modules>表示包含的所有子模块。









