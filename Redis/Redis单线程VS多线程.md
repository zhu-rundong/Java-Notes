# Redis单线程VS多线程

Redis的不同版本，架构也是不同的：

1. 版本3.x 及之前的版本，redis是单线程
2. 版本4.x，严格意义来说也不是单线程，而是负责处理客户端请求的线程是单线程。开始加了些多线程的东西(异步删除)。
3. 6.0.x 之后，Redis采用多线程来解决问题

## Redis为单线程究竟是何意？

Redis为单线程主要是指Redis的网络IO和键值对读写是由一个线程来完成的，这也是 Redis 对外提供键值存储服务的主要流程。但Redis的其他功能，比如持久化、异步删除、集群数据同步等等，其实是由额外的线程执行的。

Redis工作线程是单线程的，但是，整个Redis来说，是多线程的。

## Redis 为什么用单线程？

多线程会有共享资源的并发访问控制问题，Redis采用单线程模式，就避免了不必要的上下文切换和多线程竞争，而且单线程也大大降低了Redis内部实现的复杂度。

## 为什么单线程也能这么快？

1. Redis的大部分操作都在内存中完成
2. Redis采用了高效的数据结构，例如哈希表和跳表
3. Redis 采用了多路复用机制，使其在网络 IO 操作中能并发处理大量的客户端请求，实现高吞吐率

## I/O多路复用机制

Linux 中的 IO 多路复用机制是指一个线程处理多个 IO 流，就是我们经常听到的 select/epoll 机制。在 Redis 只运行单线程的情况下，该机制允许内核中，同时存在多个监听套接字和已连接套接字。内核会一直监听这些套接字上的连接请求或数据请求。一旦有请求到达，就会交给 Redis 线程处理，这就实现了一个 Redis 线程处理多个 IO 流的效果。

## 为什么Redis6引入多线程？

Redis在6.0推出了多线程，但是Redis 6.0中的多线程，也只是针对处理网络请求过程采用了多线程，而数据的读写命令，仍然是单线程处理的。

**Redis不是号称单线程也有很高的性能么？为什么还需要多线程？**

对于Redis而言，主要的性能瓶颈是内存或者网络带宽而并非 CPU。

‍
